{"version":3,"file":"habitat.js","sources":["../src/lib/habitat.js","../src/index.js"],"sourcesContent":["import preact from 'preact'\n/**\n * Capetalize every letter after `-`\n * Used for props passed from host DOM element\n * @param  {String} str string\n * @return {String}     Capetalized string\n */\nconst _capetalize = str => {\n  return str.replace(/-([a-z])/ig, (all, letter) => {\n    return letter.toUpperCase();\n  });\n};\n\n/**\n * [_getCurrentScriptTag internal widget to provide the currently executed script]\n * @param  {document} document [Browser document object]\n * @return {HTMLElement}     [script Element]\n */\nconst _getCurrentScriptTag = () => {\n  return document.currentScript ||\n    (() => {\n      let scripts = document.getElementsByTagName('script');\n      return scripts[scripts.length - 1];\n    })();\n};\n\n/**\n * Get the props from a host element's data attributes\n * @param  {Element} tag The host element\n * @return {Object}     props object to be passed to the component\n */\nconst _propsToPassDown = (element, attr = 'data-prop') => {\n  let attrs = element.attributes;\n  let props = {};\n\n  // ceck for another props attached to the element\n  Object.keys(attrs).forEach(key => {\n    if (attrs.hasOwnProperty(key)) {\n      let dataAttrName = attrs[key].name;\n      let propName = dataAttrName.split(attr + `-`).pop();\n      propName = _capetalize(propName);\n      if (dataAttrName !== propName) {\n        let propValue = attrs[key].nodeValue;\n        props[propName] = propValue;\n      }\n    }\n  });\n  return props;\n};\n\n/**\n * Return array of 0 or more elements that will host our widget\n * @param  {id} attrId the data widget id attribute the host should have\n * @param  {document} scope  Docuemnt object or DOM Element as a scope\n * @return {Array}        Array of matching habitats\n */\nconst _hostDOMElms = ({ name = \"data-widget\", value = null, inline = true } = {}) => {\n  let hostNodes = [];\n  let currentScript = _getCurrentScriptTag();\n  if (!value) {\n    // user did not specify where to mount - get it from script tag attributes\n    let scriptTagAttrs = currentScript.attributes;\n    // ceck for another props attached to the tag\n    Object.keys(scriptTagAttrs).forEach(key => {\n      if (scriptTagAttrs.hasOwnProperty(key)) {\n        const dataAttrName = scriptTagAttrs[key].name;\n        if (dataAttrName === 'data-mount') {\n          value = scriptTagAttrs[key].nodeValue;\n        }\n      }\n    });\n  }\n  if (!value && inline) {\n    return [].concat(currentScript.parentNode);\n  }\n  [].forEach.call(document.querySelectorAll(`[${name}]`), queriedTag => {\n    if (value === queriedTag.getAttribute(name)) {\n      hostNodes.push(queriedTag);\n    }\n  });\n  return hostNodes;\n};\n\nconst _isReady = () => {\n  return (!document.attachEvent && document.readyState === 'interactive' || document.readyState === 'complete')\n}\n\n/**\n * private _render function that will be queued if the DOM is not render\n * and executed immeidatly if DOM is ready\n */\nlet _render = (widget, hostElements, root) => {\n  hostElements.forEach(elm => {\n    let hostNode = elm;\n    let props = _propsToPassDown(elm) || {};\n    return preact.render(preact.h(widget, props), hostNode, root);\n  });\n};\n\nexport {\n  _propsToPassDown,\n  _hostDOMElms,\n  _getCurrentScriptTag,\n  _capetalize,\n  _isReady,\n  _render\n};\n","import {\n  _hostDOMElms,\n  _propsToPassDown,\n  _getWidgetScriptTag,\n  _isReady,\n  _render\n} from \"./lib/habitat\";\n\nconst habitat = Widget => {\n  // Widget represents the Preact component we need to mount\n  let widget = Widget;\n  // in case DOM has fired multipled readystate events, redner only once\n  let hasRendered = false;\n  // preact root render helper\n  let root = null;\n\n  let render = ({ name = \"data-widget\", value = null, inline = true } = {}) => {\n    let isReady = _isReady();\n    if (isReady && !hasRendered) {\n      let elements = _hostDOMElms({ name, value, inline });\n      hasRendered = true;\n      return _render(widget, elements, root);\n    }\n    // document is not ready - subscurib to readystatechange event\n    document.onreadystatechange = () => {\n      let elements = _hostDOMElms({ name, value, inline });\n      if (isReady && !hasRendered) {\n        hasRendered = true;\n        return _render(widget, elements, root);\n      }\n    };\n  };\n\n  return { render };\n};\n\nexport default habitat;\n"],"names":["_capetalize","str","replace","all","letter","toUpperCase","_getCurrentScriptTag","document","currentScript","scripts","getElementsByTagName","length","_propsToPassDown","element","attr","attrs","attributes","props","keys","forEach","hasOwnProperty","key","dataAttrName","name","propName","split","pop","propValue","nodeValue","_hostDOMElms","value","inline","hostNodes","scriptTagAttrs","concat","parentNode","call","querySelectorAll","queriedTag","getAttribute","push","_isReady","attachEvent","readyState","_render","widget","hostElements","root","hostNode","elm","preact","render","h","habitat","Widget","hasRendered","isReady","elements","onreadystatechange"],"mappings":"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"}